name: "ReviewDog workflow"
on:
  pull_request:
jobs:
  reviewdog-error:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code into the Go module directory
        uses: actions/checkout@v2
        with:
          fetch-depth: 0 # required for new-from-rev option in .golangci.yml
      - run: sudo apt-get -y -q install libboost-math-dev
        # move go out of the way temporarily to avoid "go list ./..." from installing modules
      - run: sudo mv /usr/bin/go /usr/bin/go.bak && make crypto/libs/linux/amd64/lib/libsodium.a && sudo mv /usr/bin/go.bak /usr/bin/go
        name: make libsodium.a
      - name: reviewdog-golangci-lint
        uses: reviewdog/action-golangci-lint@v2
        with:
          golangci_lint_version: "v1.41.1"
          golangci_lint_flags: "--allow-parallel-runners --disable-all -E errcheck -E gofmt -E golint -E govet -E ineffassign -E misspell"
          reporter: "github-pr-review"
          tool_name: "RD Errors"
          level: "error"
  reviewdog-warning:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code into the Go module directory
        uses: actions/checkout@v2
        with:
          fetch-depth: 0 # required for new-from-rev option in .golangci.yml
      - run: sudo apt-get -y -q install libboost-math-dev
        # move go out of the way temporarily to avoid "go list ./..." from installing modules
      - run: sudo mv /usr/bin/go /usr/bin/go.bak && make crypto/libs/linux/amd64/lib/libsodium.a && sudo mv /usr/bin/go.bak /usr/bin/go
        name: make libsodium.a
      - name: reviewdog-golangci-lint
        uses: reviewdog/action-golangci-lint@v2
        with:
          golangci_lint_version: "v1.41.1"
          golangci_lint_flags: "--allow-parallel-runners --disable-all -E staticcheck -E structcheck -E typecheck -E varcheck -E deadcode -E gosimple -E unused"
          reporter: "github-pr-check"
          tool_name: "RD Warnings"
          level: "warning"
