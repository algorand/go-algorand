name: "Build workflow"
on:
  pull_request:
jobs:
  build-windows:
    runs-on: windows-2022
    steps:
      - name: Check out code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - uses: actions/setup-go@v2
        with:
          go-version: '1.14.7'
      - run: go version
      - uses: actions/setup-python@v2
        with:
          python-version: '3.7.3'
      - run: python --version
      - name: Install dependencies
        run: |
          set -e
          export msys2='cmd //C RefreshEnv.cmd '
          export msys2+='& set MSYS=winsymlinks:nativestrict '
          export msys2+='& C:\\tools\\msys64\\msys2_shell.cmd -defterm -no-start'
          export mingw64="$msys2 -mingw64 -full-path -here -c "\"\$@"\" --"
          export msys2+=" -msys2 -c "\"\$@"\" --"
          $msys2 pacman --sync --noconfirm --needed mingw-w64-x86_64-toolchain mingw-w64-x86_64-libtool unzip autoconf automake
      - name: Build Test
        run: |
          set -e
          #export PATH=$(echo "$PATH" | sed -e 's|:/home/circleci/\.go_workspace/bin||g' | sed -e 's|:/usr/local/go/bin||g')
          # export GOPATH="/home/circleci/go"
          export ALGORAND_DEADLOCK=enable
          export SKIP_GO_INSTALLATION=True
          export PATH=/mingw64/bin:/C/tools/msys64/mingw64/bin:/usr/bin:$PATH
          export MAKE=mingw32-make
          $msys2 scripts/travis/build_test.sh
