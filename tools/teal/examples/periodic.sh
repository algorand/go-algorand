#!/usr/bin/env bash

# produce TEAL assembly for a periodic payment escrow (allow withdrawing 500000 microAlgos every 100 rounds)
python driver.py periodic-payment-escrow --dur 95 --amt 500000 --x uFVEhjBpkpKQ8sZaau0qsDsf0eW3oXFEn1Ar5o39vkk= --period 100 --rcv SKXZDBHECM6AS73GVPGJHMIRDMJKEAN5TUGMUPSKJCQ44E6M6TC2H2UJ3I --fee 100000 --timeout 44000 > periodic.teal

# compile TEAL assembly to TEAL bytecode
goal clerk compile periodic.teal -o periodic.tealc
# > periodic.teal: YT4JOMLFG6LW53LO6X7GFWX6VZH5EXFC73XDCRUCTD2O54PY5JWOFPFQQY

# initialize the escrow by sending 2000000 microAlgos into it
goal clerk send --from SKXZDBHECM6AS73GVPGJHMIRDMJKEAN5TUGMUPSKJCQ44E6M6TC2H2UJ3I --to YT4JOMLFG6LW53LO6X7GFWX6VZH5EXFC73XDCRUCTD2O54PY5JWOFPFQQY --amount 2000000 -d .
# > Sent 2000000 MicroAlgos from account SKXZDBHECM6AS73GVPGJHMIRDMJKEAN5TUGMUPSKJCQ44E6M6TC2H2UJ3I to address TKNZMFUCHDXKXZEAJI75CUYQYLQEXMS5WRYLCKSKFGSSSKC7UG4U5BBI6Q, transaction ID: HDMYOUZBDHNNLVS2YA6UKPCQU7MNYGUHXPMFYCYLNKNZWVH5XRLQ. Fee set to 1000
# > Transaction HDMYOUZBDHNNLVS2YA6UKPCQU7MNYGUHXPMFYCYLNKNZWVH5XRLQ still pending as of round 18556
# > Transaction HDMYOUZBDHNNLVS2YA6UKPCQU7MNYGUHXPMFYCYLNKNZWVH5XRLQ committed in round 18558

# take 500000 microAlgos out of the escrow. notice that the lease and first/last valid must satisfy the TEAL conditions
goal clerk send -a 500000 --to SKXZDBHECM6AS73GVPGJHMIRDMJKEAN5TUGMUPSKJCQ44E6M6TC2H2UJ3I --from-program periodic.teal  -d . --lease uFVEhjBpkpKQ8sZaau0qsDsf0eW3oXFEn1Ar5o39vkk= --firstvalid 43300 --lastvalid 43395
# > Sent 500000 MicroAlgos from account WAF2MM57CFLDO4U5LBQMDY2EPDITBZQSGLZDNNIPPBOKGRVQRDTFQKVLQ4 to address SKXZDBHECM6AS73GVPGJHMIRDMJKEAN5TUGMUPSKJCQ44E6M6TC2H2UJ3I, transaction ID: ZRT7HCZCMON4D7FF7OZJSEWW2EVAFPIDFFNUCX7V5UX2M75SKB4Q. Fee set to 1000
# > Transaction ZRT7HCZCMON4D7FF7OZJSEWW2EVAFPIDFFNUCX7V5UX2M75SKB4Q still pending as of round 24631
# > Transaction ZRT7HCZCMON4D7FF7OZJSEWW2EVAFPIDFFNUCX7V5UX2M75SKB4Q committed in round 24633
